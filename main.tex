\documentclass{article}

\usepackage[margin=1.5cm, includefoot, footskip=30pt]{geometry}

%\usepackage{minted}  % would prefer to use minted but arxiv cannot shell-escape
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{lmodern}
\usepackage{multicol}
\usepackage{standalone}
\usepackage{xcolor}
\usepackage{subcaption}

\usepackage{tikz}
\usetikzlibrary{calc, shapes, patterns}

\title{Reviving, reproducing and revisiting Axelrod's second tournamentt}

\begin{document}

\maketitle

\section{Introduction}\label{sec:introduction}

The Prisoner's Dilemma has been the centre of the study of
cooperative behaviour since Robert Axelrod's seminal work in the
1980s~\cite{Axelrod1980a, Axelrod1980b, Axelrodbook}. In this work, Robert
Axelrod invited fellow academics to write computer code to play the Iterated
Prisoner's Dilemma. This initial research has subsequently lead to a huge area
of research aiming to understand the emergence of cooperative behaviour. A good
overview of the variety of research areas is given in~\cite{Nowak2006}.

In the Prisoner's Dilemma, each player chooses
simultaneously and independently
between cooperation (C) or defection (D). The payoffs of
the game are defined by the matrix
\(
\begin{pmatrix}
    R & S \\ 
    T & P
\end{pmatrix}
\),
where $T > R > P > S$ and $2R > T + S$. The PD is a one
round game, but is commonly studied in a manner where the prior outcomes
matter. This repeated form is called the Iterated Prisoner's
Dilemma (IPD).


In Robert Axelrod's tournaments the particular values of \(R=3, P=1, S=0, T=5\)
were used.  Strategies were submitted written in either Fortran or Basic
% TODO Add a citation for bother languages
(in which case they were translated to Fortran). The very first
tournament~\cite{Axelrod1980a} involved 14 submissions  (complemented by a
fifteenth random strategy). Famously, the winner of this tournament was
Tit For Tat: a strategy that mimics the opponent's previous action. The only
sources for this work are the paper itself, all of the source code is apparently
lost. In the second tournament~\cite{Axelrod1980b} 64 strategies were submitted
and again: Tit For Tat was declared the winner. From a computation archaeological
point of view this tournament was far superior as all of the source code was
kept and made available for use, it can be found at
\url{http://www-personal.umich.edu/~axe/research/Software/CC/CC2/TourExec1.1.f.html}.

This work describes the process of reviving and using these strategies in a
modern software framework (\cite{AxelrodProject}): a Python library with over
200 strategies and a large number of analytical procedures which has been used
in ongoing research~\cite{Harper2017, Knight2017}.

Importantly, reviving the strategies is not done
through a manual exercise of reverse engineering the Fortran code which would be
prone to mistakes. This is done by calling the original functions ensuring the
\textbf{best possible reproduction and analysis of Robert Axelrod's original
work}. This will be described in more detail in Section~\ref{sec:reviving}.

Results and further analyses pertaining to reproducing the tournament will be
given in Section~\ref{sec:reproducing}. Finally, Section~\ref{sec:revisiting}
will extend the analysis to include contemporary research topics:

\begin{itemize}
    \item Experimenting with adding one of over 196 other strategies
        from~\cite{AxelrodProject} to see how the results change.
    \item Training strategies to perform at a high level using Genetic Algorithms.
    \item Investigating the overall performance of Zero determinant
        strategies~\cite{Press2012}.
    \item Running a tournament with all considered strategies (more than 250).
\end{itemize}

This work contributes to the game theoretic literature by providing the first
exercise in reproducing reported results that have been at the core of the study
of cooperation. Furthermore it also provides a contemporary lense which, amongst
other things concludes with one of the largest Iterated Prisoner's Dilemma
tournaments.
Finally, by reviving the original code and making it available to use
in~\cite{AxelrodProject} it is now possible to use the original strategies of
Robert Axelrod's second tournament in a modern framework which for example
allows for the study of topological and evolutionary variants.

\section{Reviving the tournament}\label{sec:reviving}

As described in Section~\ref{sec:introduction}, the original source code for
Axelrod's second tournament was written in Fortan (some contributors submitted
code in Basic), this was subsequently published at~\cite{Axelrod1980bCode}. This
website maintained by the University of Michigan Center for the Study of Complex
Systems was last updated (at the time of writing) in 1996. The source code
available consists of a single file \texttt{TourExec1.1.f}.


For the purposes of this work this Fortran code was minimally modified so that
it would run on a modern Fortran compiler.
Furthermore, each strategy was extracted in to a single modular file which
follows modern best practice and makes analysis more readable. This can be found
at \url{https://github.com/Axelrod-Python/TourExec} and has been archived
at~\cite{TourExec}.

A Python library has been written that enables an interface to
the Axelrod library described in the previous section. This library is referred
to as the \texttt{Axelrod\_fortran} library and is available
at \url{https://github.com/Axelrod-Python/axelrod-fortran} and the specific
version used for this work is~\cite{Axelrod_fortran}.
This library has the fortran code of the original tournament as a dependency but
otherwise offers a straightforward to install (using standard scientific python
packages) and use option for the study of
the strategies of~\cite{Axelrod1980b}.
This is made possible thanks to the translation of the compiled Fortran in to C
which can be used directly by the Python software.
For this to work there are a variety of minor translations that need to take
place. As documented at
\url{http://www-personal.umich.edu/~axe/research/Software/CC/CC2/TourExec1.1.f.html}
the Fortran code implies that each strategy is a Fortran function which takes
the following inputs.

\begin{itemize}
    \item  \texttt{J}: The opponent's previous move: 0 corresponds to a
        defection and 1 to a cooperation.
    \item \texttt{M}: The current turn number (starting at 1).
    \item \texttt{K}: The player's current cumulative score.
    \item \texttt{L}: The opponent's current cumulative score.
    \item \texttt{R}: A random number between 0 and 1: used by stochastic
        strategies.
    \item \texttt{JA}: The player's previous move.
\end{itemize}

For example, Figure~\ref{fig:tft_fortran} shows the source code for
\texttt{k92r.f} also known as Tit For Tat.

\begin{figure}[!hbtp]
    \begin{center}
        \begin{lstlisting}[language=Fortran,
                           basicstyle=\ttfamily,
                           frame=single,
                           keywordstyle=\color{red},
                           commentstyle=\color{green}]
          FUNCTION K92R(J,M,K,L,R, JA)
    C BY ANATOL RAPOPORT
    C TYPED BY AX 3/27/79 (SAME AS ROUND ONE TIT FOR TAT)
    c replaced by actual code, Ax 7/27/93
    c  T=0
    c   K92R=ITFTR(J,M,K,L,T,R)
          k92r=0
          k92r = j
    c test 7/30
    c   write(6,77) j, k92r
    c77   format(' test k92r. j,k92r: ', 2i3)
          RETURN
          END
        \end{lstlisting}
        \caption{Fortran Source code for original Tit For Tat strategy submitted
        to Axelrod's second tournament.}
        \label{fig:tft_fortran}
    \end{center}
\end{figure}


The \texttt{Axelrod} library takes advantage of the modern Object Oriented
framework in Python. Each strategy is a class with agent based behaviour. The
input to each player is simply the opponent with both holding their respective
history of plays. In the newly written \texttt{Axelrod\_fortran} library a
class inherited from the base \texttt{Axelrod} class is written that interfaces
with the Fortran strategies and the Python requirements. This includes, for
example passing an initial move required by the Fortran player: using the
original Fortran code as reference (see Figure~\ref{fig:tournament_code}) it
is assumed that the assumed prior move is
a cooperation (which is in line with Figure~\ref{fig:tft_fortran}).

\begin{figure}[!hbtp]
    \begin{center}
        \begin{lstlisting}[language=Fortran,
                           basicstyle=\ttfamily,
                           frame=single,
                           keywordstyle=\color{red},
                           numbers=left,
                           firstnumber=67,
                           commentstyle=\color{green}]
      Do 20 Game = 1,5
            RowGameSc = 0
            ColGameSc = 0
            JA = 0          ! Row's previous move, reported to column
            JB = 0          ! Col's previous move, reported to row
        \end{lstlisting}
        \caption{A portion of the original tournament code
            \url{https://github.com/Axelrod-Python/TourExec/blob/master/src/tournament/AxTest.f}
            setting the default
        previous move to a cooperation and score to 0.}
        \label{fig:tournament_code}
    \end{center}
\end{figure}

Figure~\ref{fig:strategy_diagram} shows a diagrammatic representation of the
interface between the Python strategy and the Fortran function.

\begin{figure}[!hbtp]
    \begin{center}
        \scalebox{.8}{
            \includestandalone{assets/strategy_diagram}
                     }
        \caption{The interface between the Python axelrod library and the
        Fortran code}
        \label{fig:strategy_diagram}
    \end{center}
\end{figure}

The major advantage of this approach is that at no point has any subjectivity
been added to the process of replicating Axelrod's second tournament. Indeed for
some strategies the only description available is the Fortran code itself, thus
they are being run and used as available. To the authors' knowledge this is the
best possible way to replicate Axelrod's work which is the subject of the next
section.

\section{Reproducing the tournament}\label{sec:reproducing}

From~\cite{Axelrod1980b}, the following characteristics of the original
tournament have been identified:

\begin{itemize}
    \item Matches have length from \(\{63, 77, 151, 308, 157\}\);
    \item Players do not know the number of rounds in a given match;
    \item A total of \input{assets/number_of_original_repetitions.tex}repetitions
        across the various match lengths have been carried out.
\end{itemize}

Note that there is some lack of clarity in~\cite{Axelrod1980b} as to the length
of the matches:

\begin{quote}
    \textit{``As announced in the rules, the length of the games was determined
        probabilistically with a .00346 chance of ending with each given move.
        This parameter was chosen so that the expected median length of a game
        would be 200 moves. In practice, each pair of players was matched five
        times, and the lengths of these five games were determined once and for
        all by drawing a random sample. The resulting random sample from the
        implied distribution specified that the five games for each pair of
        players would be of lengths 63, 77, 151, and 308 moves. Thus the average
    length of a game turned out to be somewhat shorter than expected at 151
moves.''}
\end{quote}

As only four match length samples were specified but the average was given, a
fifth match length of 157 is assumed.  It seems that the only stochastic
smoothing used was these five repetitions, without a known seed it is not
possible to replicate, thus the original tournament is repeated a total of
\input{assets/number_of_original_repetitions.tex}for each match length.

The replicated scores and corresponding rankings of each strategy across all
repetitions are shown in
Figure~\ref{fig:replicated_tournament}.

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.5\textwidth}
        \includegraphics[width=.95\textwidth]{assets/original_tournament_scores.pdf}
        \caption{Average score per turn of each strategy.}
        \label{fig:original_tournament_scores}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{0.5\textwidth}
        \includegraphics[width=.95\textwidth]{assets/original_tournament_rankings.pdf}
        \caption{Ranking of each strategy.}
        \label{fig:original_tournament_ranks}
    \end{subfigure}
    \caption{Replicated tournament with strategies ordered by original rank}
    \label{fig:replicated_tournament}
\end{figure}

The top 15 strategies in the reproduced tournament are shown in
Table~\ref{tbl:original_tournament_rankings}.

\begin{table}[!hbtp]
        \centering
        \input{./assets/original_tournament_rankings.tex}
        \caption{Top 15 strategies in the reproduced tournament}
        \label{tbl:original_tournament_rankings}
\end{table}

Whilst the results mainly agree with the original reported results, some
strategies are distinct outliers \texttt{k61r} and \texttt{k90r}:

\begin{itemize}
    \item \texttt{k61r}: Is referred to as Champion: cooperates for the first 10
        moves, plays tit for tat for the next fifteen and then will cooperate
        unless: the other player defected on the previous move, the
        other player cooperated less than 60\% and a random number between
        0 and 1 is greater that the other player's cooperation rate.
        When run on a modern Fortran compiler this strategy does not behave as
        expected.
    \item \texttt{k90r}: Is described as the well known Tit For Two Tats,
        however as written the Fortran code includes an error that implies that
        it is essentially a strategy that always cooperates.
\end{itemize}

In~\cite{Axelrod1980b}, a linear regression model is used to identify 5
strategies, the scores against which are good predictors of the overall
performance. The reported \(R^2\) value is \(0.979\) (indicating 97\% of
variance accounted for by the model). The coefficients of this model are shown
in Table~\ref{tbl:original_tournament_representative_model}.

\begin{table}[!hbtp]
        \centering
        \input{./assets/original_tournament_representative_model.tex}
        \caption{Linear model described in~\cite{Axelrod1980b} with
             \(R^2=\protect\input{assets/original_tournament_representative_r_squared.tex}\)}
        \label{tbl:original_tournament_representative_model}
\end{table}

Given the discrepancy in results shown in
Figure~\ref{fig:original_tournament_rankings} and
Table~\ref{tbl:original_tournament_rankings} it is not surprising to see that
this model no longer performs as well with
\(R^2=\input{assets/original_tournament_representative_r_squared.tex}\).

Fitting a new model to the same 5 strategies gives the coefficients shown in
Table~\ref{tbl:original_tournament_predictive_with_axelrod_5_model} with
\(R^2=\input{assets/original_tournament_predictive_5_r_squared.tex}\)

\begin{table}[!hbtp]
        \centering
        \input{./assets/original_tournament_predictive_with_axelrod_5_model.tex}
        \caption{Linear model fitted to the same 5 strategies described
                 in~\cite{Axelrod1980b} with
             \(R^2=\protect\input{assets/original_tournament_predictive_5_r_squared.tex}\)}
        \label{tbl:original_tournament_predictive_with_axelrod_5_model}
\end{table}

Using recursive feature elimination
% TODO Include a text book reference
It is possible to select the features (strategies) that give the best prediction
for a given number of features. The \(R^2\) versus the number of features is
shown in
Figure~\ref{fig:original_tournament_r_squared_versus_number_of_features}.

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/original_tournament_r_squared_versus_number_of_features.pdf}
    \caption{\(R^2\) for models obtained using recursive feature elimination.}
    \label{fig:original_tournament_r_squared_versus_number_of_features}
\end{figure}


Tables~\ref{tbl:original_tournament_predictive_5_model}
and~\ref{tbl:original_tournament_predictive_12_model} show the coefficients for
linear models fitted to 5 and 12 strategies with
\(R^2=\input{assets/original_tournament_predictive_5_r_squared.tex}\) and
\(R^2=\input{assets/original_tournament_predictive_12_r_squared.tex}\)
respectively (12 strategies is the smallest number of strategies for which
\(R^2>95\).


\begin{table}[!hbtp]
        \centering
        \input{./assets/original_tournament_predictive_5_model.tex}
        \caption{Linear model best fitted to 5 strategies in the reproduced tournament
                 with
             \(R^2=\protect\input{assets/original_tournament_predictive_5_r_squared.tex}\)}
        \label{tbl:original_tournament_predictive_5_model}
\end{table}

\begin{table}[!hbtp]
        \centering
        \input{./assets/original_tournament_predictive_12_model.tex}
        \caption{Linear model best fitted to 12 strategies in the reproduced tournament
                 with
             \(R^2=\protect\input{assets/original_tournament_predictive_12_r_squared.tex}\)}
        \label{tbl:original_tournament_predictive_12_model}
\end{table}

The predictions of these models are shown in
Figure~\ref{fig:original_tournament_predictive_score_models}.

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.9\textwidth]{assets/original_tournament_predictive_score_models.pdf}
    \caption{Predicting the performance of strategies using the 4 models
             discussed}
    \label{fig:original_tournament_predictive_score_models}
\end{figure}

It is clear that the effectiveness of the predictive models with 5 strategies is
low for the cluster of highly performing strategies (with a score great than
2.5). To be able to obtain a good model even for high performing strategies 12
seem to provide a good predictive model.

The overall cooperation rate of the tournament
is \input{assets/original_tournament_overall_cooperation_rate.tex}.
Figure~\ref{fig:original_tournament_cooperation_rate_versus_rank} shows the
cooperation rate versus the rank of the strategy.

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/original_tournament_cooperation_rate_versus_rank.pdf}
    \caption{Cooperation rate versus rank}
    \label{fig:original_tournament_cooperation_rate_versus_rank}
\end{figure}



\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/original_tournament_cooperation_rates.pdf}
    \caption{Distribution of cooperation rates}
    \label{fig:original_tournament_cooperation_rates}
\end{figure}

Figure~\ref{fig:original_tournament_pairwise_cooperation_rates} shows the pair wise
cooperation rates. There is one strategy `k42r' that defects against itself but
cooperates against most other strategies. Also, it is clear that the low
performing strategies are defecting against each other.

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/original_tournament_pairwise_cooperation_rates.pdf}
    \caption{Cooperation rates between each pair of players (ordered by rank)}
    \label{fig:original_tournament_pairwise_cooperation_rates}
\end{figure}


\section{Revisiting the tournament}\label{sec:revisiting}

\subsection{Running with an extra invitation}\label{sec:extra_strategy}

\subsubsection{Known strategies}

The tournament is run with every strategy of the Axelrod library.
% TODO Cite properly
% TODO Point at appendix
Every tournament (corresponding to each strategy) was run
for \input{assets/number_of_extra_strategy_repetitions.tex}repetitions.
Table~\ref{tbl:original_tournament_with_extra_strategy_summary} shows the top
ranking strategies.

\begin{table}[!hbtp]
        \tiny
        \centering
        \input{assets/original_tournament_with_extra_strategy_summary.tex}
        \caption{Performance of extra strategy in Axelrod's original tournament}
        \label{tbl:original_tournament_with_extra_strategy_summary}
\end{table}

Figure~\ref{fig:original_tournament_with_extra_strategy_ranks_vs_library_ranks}
shows the rank of the extra strategy against it's rank in the library
tournament.

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/original_tournament_with_extra_strategy_ranks_vs_library_ranks.pdf}
    \caption{Ranks of extra strategy}
    \label{fig:original_tournament_with_extra_strategy_ranks_vs_library_ranks}
\end{figure}

\subsubsection{Trained strategies}

Using the various strategy sets and weights from the previous regression
analysis
% TODO Improve how this points and refers to training
it is possible to train strategies to compete in the tournament.
% TODO Add details about training (software + algorithm): also include a diagram
% about process (mutation and crossover)
Figure~\ref{fig:training_data_max_score} show the mean utility of the strategies
trained for this work. The strategies trained are 10 state Finite State
machines.
% TODO Include references.
% TODO Draw final fsm ones.

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/training_data_max_score.pdf}
    \caption{The maximum score per generation over the training periods}
    \label{fig:training_data_max_score}
\end{figure}

The relative score is not necessarily interpretable (the weights of the
particular regression model skew this).
% TODO Add more details

Table~\ref{tbl:original_tournament_with_trained_strategy} shows the results of
the trained strategy in the tournament.

\begin{table}[!hbtp]
        \centering
        \tiny
        \input{./assets/original_tournament_with_trained_strategy.tex}
        \caption{Results of trained strategy based on environment.}
         \label{tbl:original_tournament_with_trained_strategy}
\end{table}


\subsection{Further tournaments}

% TODO As a brief conclusion show results for these two larger tournaments.

\subsubsection{Running with extortion}\label{sec:run_with_stewart_plotkin}

Since the work of~\cite{Press2012} a lot of interest has been shown to Zero
Determinant strategies. In~\cite{Stewart2012} a small tournament is presented
pitting these against each other. Table~\ref{tbl:sp_tournament_rankings}
shows the rankings of the top 15 strategies when including all the Zero
Determinant strategies from~\cite{Stewart2012} over
\input{assets/number_of_sp_repetitions.tex}repetitions.

\begin{table}[!hbtp]
        \centering
        \input{./assets/sp_tournament_rankings.tex}
        \caption{Top 15 strategies in the tournament composed of the original
                 strategies and the Zero Determinant strategies
                 from~\cite{Stewart2012}}
        \label{tbl:sp_tournament_rankings}
\end{table}

The overall cooperation rate of this tournament is
\input{assets/sp_tournament_overall_cooperation_rate.tex}and the various
cooperation rates are shown in
Figure~\ref{fig:sp_tournament_cooperation_rate_versus_rank} shows the
cooperation rates of each strategy (ordered by rank).

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/sp_tournament_cooperation_rate_versus_rank.pdf}
    \caption{Cooperation rate versus rank for the Stewart and Poltkin tournament}
    \label{fig:sp_tournament_cooperation_rate_versus_rank}
\end{figure}


\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/sp_tournament_cooperation_rates.pdf}
    \caption{Distribution of cooperation rates for the Stewart and Plotkin
    tournament}
    \label{fig:sp_tournament_cooperation_rates}
\end{figure}

Figure~\ref{fig:sp_tournament_pairwise_cooperation_rates} shows the pair wise
cooperation rates.

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/sp_tournament_pairwise_cooperation_rates}
    \caption{Cooperation rates between each pair of players (ordered by rank)
    for the Stewart and Plotkin tournament}
    \label{fig:sp_tournament_pairwise_cooperation_rates}
\end{figure}

\subsubsection{Running a large tournament}\label{sec:run_with_everyone}

Table~\ref{tbl:full_tournament_rankings}
shows the rankings of the top 20 strategies when including all strategies over
\input{assets/number_of_full_repetitions.tex}repetitions.
The cooperation rate for the tournament that pits all the library strategies
against each other (without the Fortran ones) is
\input{assets/library_tournament_cooperation_rate.tex}\unskip.

\begin{table}[!hbtp]
        \centering
        \footnotesize
        \input{./assets/full_tournament_rankings.tex}
        \caption{Top 20 strategies in the tournament when using all available
        strategies}
        \label{tbl:full_tournament_rankings}
\end{table}

The overall cooperation rate of this tournament is
\input{assets/full_tournament_overall_cooperation_rate.tex}and the various
cooperation rates are shown in
Figure~\ref{fig:full_tournament_cooperation_rate_versus_rank} shows the
cooperation rates of each strategy (ordered by rank).

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/full_tournament_cooperation_rate_versus_rank.pdf}
    \caption{Cooperation rate versus rank for tournament with all available
    strategies}
    \label{fig:full_tournament_cooperation_rate_versus_rank}
\end{figure}

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/full_tournament_cooperation_rates.pdf}
    \caption{Distribution of cooperation rates for the full tournament.}
    \label{fig:full_tournament_cooperation_rates}
\end{figure}

Figure~\ref{fig:full_tournament_pairwise_cooperation_rates} shows the pair wise
cooperation rates.

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.8\textwidth]{assets/full_tournament_pairwise_cooperation_rates}
    \caption{Cooperation rates between each pair of players (ordered by rank)
    for tournament with all available strategies}
    \label{fig:full_tournament_pairwise_cooperation_rates}
\end{figure}

\section{Conclusion}\label{sec:conclusion}

\section*{Acknowledgements}

% TODO Write appendices for the Axelrod strategies

\bibliographystyle{plain}
\bibliography{bibliography.bib}

\appendix

\section{List of original players}\label{app:list_of_original_players}


\begin{multicols}{2}
    \begin{enumerate}
            \input{assets/list_of_original_tournament_players.tex}
    \end{enumerate}
\end{multicols}


\end{document}
